<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Waterbear: Code Garden</title>
	<link href="dist/javascript.css" rel="stylesheet" />

	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="viewport" content="height=device-height, initial-scale=1.0" />
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
	<!--link rel="apple-touch-icon-precomposed" href="icon.png"--><!-- 57x57 icon -->
	<!--link rel="apple-touch-startup-image" href="default.png"--><!-- 320x460 image -->
	<!--script src="/lib/modernizr-1.6.min.js"></script-->
</head>
<body>
	<div id="context_menu"></div>
	<div id="block_menu_load">
		Loading...
	</div>
	<div class="content editor">

		<nav id="nav" role="navigation">
			<h1 class="title">Waterbear </h1>
			<ul id="menu">
				<li>
					<a class="clear_scripts" href="#">New</a>
				</li>
				<li>
					<a class="load_from_gist" href="#">Open Gist</a>
				</li>
				<li>
					<a class="restore_scripts" href="#">Open File</a>
				</li>
				<li>
					<a class="save_scripts" href="#">Save Gist</a>
				</li>
				<li>
					<a class="download_scripts" href="#">Save File</a>
				</li>
				<li>
					<a href="#">Examples</a>
				</li>
				<li>
					<a class="runScripts" href="#">Run</a>
				</li>
				<li>
					<a class="cmenuEnable" href="#"><i class="icon-list-alt"></i> Enable Context Menus</a>
				</li>
			</ul>
		</nav>
		<div class="menu_buttons">
			<a href="#nav">Show menu</a>
			<a href="#">Hide menu</a>
		</div>
		<div id="block_menu"></div>
		<div class="workspace blockview">
			<div class="tabbar">
				<div class="scripts_workspace_tab chrome_tab selected">Script Blocks</div>
				<div class="scripts_text_view_tab chrome_tab">Script Text</div>
			</div>
			<div class="scripts_text_view"></div>
		</div>
	</div>
	<div class="content result">
		<div class="menubar">
			<button class="edit_script ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">Edit</span></button>
			<button class="clear_canvas ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">Clear</span></button>
			<button class="runScripts ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">Restart</span></button>
		</div>
		<div class="stage"><iframe class="stageframe" width="100%" height="100%" src="//waterbearlang.github.com/iframerunner/index2.html"></iframe></div>
	</div>
	<svg><text></text></svg>
	<script src="dist/javascript.js"></script>
	<script>
	function blockManager() {

		var closed = true;

		var addSettingsLink = function (callback) {
			var block_menu = document.querySelector('#block_menu');
			var settings_link = document.createElement('a');
			settings_link.href = '#';
			settings_link.style.float = 'right';
			settings_link.appendChild(document.createTextNode('Show/Hide blocks'));
			settings_link.addEventListener('click', toggleCheckboxDisplay);
			block_menu.appendChild(settings_link);
			return settings_link;
		}

		var createCheckboxes = function () {
			var block_headers = document.querySelectorAll('.accordion-header');
			[].forEach.call(
				block_headers,
				function (el) {
					var checkbox = document.createElement('input');
					checkbox.type = 'checkbox';
					checkbox.value = '1';
					checkbox.style.float = 'right';
					checkbox.style.display = 'none';
					checkbox.checked = 'true';
					checkbox.addEventListener('click', hideBlocks);
					el.appendChild(checkbox);
				});
		};

		//settings link has been clicked
		var toggleCheckboxDisplay = function () {
			console.log('called');
			var checkboxes = document.querySelectorAll('.accordion-header input[type="checkbox"]');
			var block_menu = document.querySelector('#block_menu');
			var display;

			if (closed) {
				closed = false;
				display = 'inline';
				block_menu.addClass("settings");
				settings_link.innerHTML = 'Save';
			} else {
				closed = true;
				display = 'none'
				block_menu.removeClass("settings");
				settings_link.innerHTML = 'Show/Hide blocks';
			}
			[].forEach.call(checkboxes, function (el) {
				el.style.display = display;
			});
		};

		//checkbox has been clicked
		var hideBlocks = function (e) {
			var parent = this.parentNode;
			if (this.checked) {
				parent.removeClass('hidden');
			} else {
				parent.addClass('hidden');
			}
			e.stopPropagation();
		};

		//onload we want to create the settings and checkboxes
		var settings_link = addSettingsLink();
		createCheckboxes();
	}

	window.onload = new blockManager();

	Element.prototype.hasClass = function (name) {
		return new RegExp("(?:^|\\s+)" + name + "(?:\\s+|$)").test(this.className);
	};

	Element.prototype.addClass = function (name) {
		if (!this.hasClass(name)) {
			this.className = this.className ? [this.className, name].join(' ') : name;
		}
	};

	Element.prototype.removeClass = function (name) {
		if (this.hasClass(name)) {
			var c = this.className;
			this.className = c.replace(new RegExp("(?:^|\\s+)" + name + "(?:\\s+|$)", "g"), "");
		}
	};
	</script>
	<style>
	#block_menu.settings .accordion-header.hidden {
		display:block;
		opacity:0.5;
	}
	#block_menu .accordion-header.hidden {
		display:none;
	}
	</style>
</body>
</html>
